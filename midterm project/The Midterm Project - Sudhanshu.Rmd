---
title: "The Midterm Project of Thunder, Team 2"
output: html_document
date: "2022-10-21"
---

### Load Data

```{r}
midterm = data.frame(read.csv("dataset/train.csv"))
midterm2 = subset(midterm, Month=="January")

midterm2_subset <- midterm2[ , names(midterm2) %in% c("ID", "Name", "Age", "Annual_Income", "Num_Bank_Accounts", "Num_Credit_Card", "Interest_Rate", "Num_of_Loan", "Num_of_Delayed_Payment", "Credit_Mix", "Total_EMI_per_month", "Monthly_Balance", "Credit_Score")]
str(midterm2_subset)
```

### Data Cleaning

```{r}
# midterm2_subset =
library('dplyr')
library('purrr')
library('tidyr')
library("stringr")
```

```{r Brooklyn_1}
# "Age"
# Removed Special Characters & Changed the data type into "int"
midterm2_subset$Age <- gsub("[[:punct:]]", "", midterm2_subset$Age)
midterm2_subset$Age <- as.integer(midterm2_subset$Age)

# "Annual_Income"
# Removed Special Characters & Changed the data type into "num" & Rounded
midterm2_subset$Annual_Income <- as.numeric(sub("_", "", midterm2_subset$Annual_Income))

```

```{r HaeLee_1}
# "Num_of_Loan" 
# Removed Special Characters & Changed the data type from "char" to "int"
midterm2_subset$Num_of_Loan <- gsub("[[:punct:]]", "", midterm2_subset$Num_of_Loan)
midterm2_subset$Num_of_Loan <- as.integer(midterm2_subset$Num_of_Loan)

# "Num_of_Delayed_Payment"
# Removed Special Characters & Changed the data type from "char" to "int"
midterm2_subset$Num_of_Delayed_Payment <- gsub("[[:punct:]]", "", midterm2_subset$Num_of_Delayed_Payment)
midterm2_subset$Num_of_Delayed_Payment <- as.integer(midterm2_subset$Num_of_Delayed_Payment)

# "Num_of_Loan"
# Removed value below 0 
midterm2_subset <- midterm2_subset[midterm2_subset['Num_of_Loan'] >= 0, ]
```

```{r Upmanyu_1}
# "Credit_Mix"
# Removed Special Characters 
# Converted "char" into "int" from "Good" to 3, "Standard" to 2, and "Bad" to 1
midterm2_subset <- midterm2_subset[midterm2_subset['Credit_Mix'] != "_",]
midterm2_subset$Credit_Mix[midterm2_subset$Credit_Mix == 'Bad'] <- 1
midterm2_subset$Credit_Mix[midterm2_subset$Credit_Mix == 'Standard'] <- 2
midterm2_subset$Credit_Mix[midterm2_subset$Credit_Mix == 'Good'] <- 3
midterm2_subset$Credit_Mix <- as.integer(midterm2_subset$Credit_Mix)
```

```{r Sudhanshu_1}
# Rounded "Total_EMI_per_month"
midterm2_subset["Total_EMI_per_month"] <- 
round(midterm2_subset["Total_EMI_per_month"], digits = 2)

# "Monthly_Balance"
# Converted into "int" and rounded 
midterm2_subset$Monthly_Balance <- as.integer(midterm2_subset$Monthly_Balance)
midterm2_subset["Monthly_Balance"] <- round(midterm2_subset["Monthly_Balance"], digits = 2)

# "Credit_score"
# Removed Special Characters
# Converted "char" into "int" from "Good" to 3, "Standard" to 2, and "Bad" to 1
midterm2_subset <- midterm2_subset[midterm2_subset['Credit_Score'] != "_",]
midterm2_subset$Credit_Score[midterm2_subset$Credit_Score == 'Poor'] <- 1
midterm2_subset$Credit_Score[midterm2_subset$Credit_Score == 'Standard'] <- 2
midterm2_subset$Credit_Score[midterm2_subset$Credit_Score == 'Good'] <- 3
midterm2_subset$Credit_Score <- as.integer(midterm2_subset$Credit_Score)
```

```{r Upmanyu_2}
# Removed NA from data
midterm2_subset = na.omit(midterm2_subset)
# Filtered out a group age under 18
midterm2_subset<-midterm2_subset[!(midterm2_subset$Age < 18),]
```

### Descriptive Statistics 

```{r}
summary(midterm2_subset)
str(midterm2_subset)
```

### EDA

## Prepare EDA
# Use Libaries
```{r}
library(ggplot2)
library(ezids)
```

```{r Sudhanshu}
# EDA for Total EMI
df=outlierKD2(df, Total_EMI_per_month, TRUE, FALSE, FALSE, FALSE)
summary(df)
# nrow(df)

zero_emi <- subset(df, Total_EMI_per_month == 0)
str(zero_emi)

not_zero_emi <- subset(df, Total_EMI_per_month != 0)
```

# T-test at 0.95 Confidence Level for the Total EMI per Month
```{r Sudhanshu}
Total_Emi = t.test(x=df$Total_EMI_per_month)
Total_Emi
```
Result: All are rejected since p-value are below 0.05, which means that each true mean is not equal to 0.

# Boxplot for the Total EMI per month
```{r Sudhanshu}
ggplot(df, aes(x=Credit_Score, y=Total_EMI_per_month)) + geom_boxplot( colour=c("red","green","blue")) +
  labs(title="Boxplot of the Total EMI per month with different Credit Scores", x="Credit Score", y = "Number Total_EMI_per_month Delayed Payment")
```

# Histogram for the Total EMI per month
```{r Sudhanshu}

# All Groups by colors
ggplot(zero_emi, aes(x=Total_EMI_per_month, fill = Credit_Score)) + geom_histogram(binwidth = 1) + ggtitle ("Histogram of the Total EMI per month") + xlab("Total EMI per month") + ylab("Total count")

ggplot(not_zero_emi, aes(x=Total_EMI_per_month, fill = Credit_Score)) + geom_histogram(binwidth = 1) + ggtitle ("Histogram of the Total EMI per month") + xlab("Total EMI per month") + ylab("Total count")
```

# QQ-Plot with QQ line for the Number of Delayed Payment
```{r HaeLee_7}
# All Group
qqnorm(df$Total_EMI_per_month, col="dodgerblue2", main="QQ-plot of the Total EMI per month")
qqline(df$Num_of_Delayed_Payment)
# Zero EMI Group
qqnorm(zero_emi$Total_EMI_per_month, col="red", main="QQ-plot of the Total EMI per month in zero EMI Group")
qqline(Poor$Num_of_Delayed_Payment)
# Non zero Group
qqnorm(not_zero_emi$Total_EMI_per_month, col="green", main="QQ-plot of the Total EMI per month in non zero EMI Group")
qqline(Poor$Num_of_Delayed_Payment)
```

# ANOVA for the Number of Delayed Payment
```{r Sudhanshu}
# Does the three subgroups have different the Number of Delayed Payment average?
anova_toal_emi = aov(Total_EMI_per_month ~ Credit_Score, data=df)
anova_toal_emi
names(anova_toal_emi)
xkabledply(anova_toal_emi, title = "ANOVA result summary total EMI per month between Credit Score")
```

# Post-hoc Tukey HSD for the Number of Delayed Payment
```{r HaeLee_9}
# Since they are not all the same, we need to follow up with a post-hoc test.
tukeyAoVemi <- TukeyHSD(anova_toal_emi)
tukeyAoVemi
```



```{r Upmanyu}
# EDA for Number of Loan

```
